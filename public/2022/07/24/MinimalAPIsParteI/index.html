<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Desarrollo de software, .NET 6, ASP.NET Core 6, ASP.NET Core Entity Framework, Test Unitarios, Minimal APIs, Visual Studio Code, Web App">
    <meta name="description" content="">
    <meta name="author" content="Juan Manuel Cutrera">

    
    <title>
        
            Paso a paso, cómo desarrollar Minimal APIs en ASP.NET Core 6 con Visual Studio Code (Parte I) |
        
        binmodule
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/module.svg">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">
  
       
    
<link rel="stylesheet" href="/js/prismjs/plugins/line-numbers/prism-line-numbers.min.css">
  
    
<link rel="stylesheet" href="/js/prismjs/plugins/toolbar/prism-toolbar.min.css">
    
    

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","language":"es","path":"search.xml"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":false},"style":{"primary_color":"#2bbc8a","avatar":"/images/avatar.svg","favicon":"/images/module.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"500px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":false,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":false},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="binmodule" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper"  >

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/images/module.svg">
                </a>
            
            <a class="logo-title" href="/">
                binmodule
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVOS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                CATEGORÍAS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                TAGS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                ACERCA DE
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVOS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">CATEGORÍAS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">TAGS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">ACERCA DE</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>


    

   


</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    

<div class="fade-in-down-animation">
    <div class="article-content-container" >
      
        <div class="article-title" >
            <span class="title-hover-animation">Paso a paso, cómo desarrollar Minimal APIs en ASP.NET Core 6 con Visual Studio Code (Parte I)</span>            
        </div>
        
            <span style="display: inline-block; height: 2px;"></span>
            <div class="article-title"  >
                <img src='/images/posts/2022/MinimalAPIsParteI/Minimal APIs Parte I.png'                  
                loading="lazy"
                decoding="async" 
                alt='Minimal APIs para simplificar el código'
                title='Minim al APIs en ASP.NET Core 6'
                style="width:100%;"/>    
            </div>
        

        
            <div class="article-header-meta-info">
                <div class="meta-info">
                    <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2022-07-24 19:53:36</span>
        <span class="mobile">2022-07-24 19:53</span>
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/NET/">.NET</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/NET-6/">.NET 6</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Minimal-APIs/">Minimal APIs</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/ASP-NET-Core-Entity-Framework/">ASP.NET Core Entity Framework</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>2.5k Palabra/s</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>15 Minuto/s</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                </div>
            </div>
        

        <div class="article-content markdown-body">
            <blockquote>
<p>ASP.NET Core 6 nos ofrece un enfoque de desarrollo de APIs HTTP más liviano en comparación al tradicional de ASP.NET MVC, llamado APIs Mínimas o Minimal APIs. La reducción y optimización de código puede traducirse en mejoras de performance y en una simplificación de nuestro proceso de desarrollo de aplicaciones web.<br>Voy escribir una serie de artículos sobre está temática experimentando con sus distintas posibilidades.</p>
</blockquote>
<h3 id="Introduccion"><a href="#Introduccion" class="headerlink" title="Introducción"></a>Introducción</h3><p>Para comenzar necesitás tener instalado en tu equipo .NET 6.<br>Si no sabés que versiones de .NET tenés instaladas, abrí una terminal - en mi caso utilizo powershell * en Visual Studio Code ** (que es un IDE liviano y libre)  - y ejecutá el siguiente comando:</p>
<pre class="line-numbers language-none"><code class="language-none">dotnet --list-sdks<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/images/posts/2022/MinimalAPIsParteI/Net List SDKs.png" loading="lazy" decoding="async" 
title=".NET SDKs 6" 
alt=".NET SDKs instalados" 
class="article-image"/></p>
<p>Las distintas versiones de .NET las encontrás en <a class="link"   target="_blank" rel="noopener" href="https://dotnet.microsoft.com/en-us/download" >https://dotnet.microsoft.com/en-us/download<i class="fas fa-external-link-alt"></i></a><br>.NET Core es libre, de código abierto y multiplataforma. Funciona eficientemente en sistemas Windows, Linux y macOS.<br>Un punto interesante y que nos da tranquilidad, es que .NET 6 nos brinda actualmente una versión LTS (acrónimo de <strong>L</strong>ong <strong>T</strong>erm <strong>S</strong>upport o soporte a largo plazo). Este servicio no aplica en .NET 5.0 cuyo soporte a la fecha caducó.<br>Por esta cuestión, en una compañía a la cual proporciono servicios de desarrollo tuvimos que migrar de versión .NET 5.0 a .NET 6.0 en cuestión de pocos meses con los percances que ocasiona este proceso.<br>Una vez verificado que tenés instalado .NET 6, procedé con la creación de un proyecto web con minimal APIs utilizando la plantilla vacía de ASP.NET.<br>Creá tu proyecto dentro de una carpeta con un nombre acorde y ejecutá el comando</p>
<pre class="line-numbers language-none"><code class="language-none">dotnet new web<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>HTTPS se ha convertido en el estándar para ambientes de producción como de desarrollo, por lo tanto, si te aparece el error de confianza de certificado, tenés que ejecutar el siguiente comando para desarrollar bajo HTTPS con un certificado auto firmado</p>
<pre class="line-numbers language-none"><code class="language-none">dotnet  dev-certs https<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Ahora podés ejecutar la aplicación creada dentro de la carpeta con el comando</p>
<pre class="line-numbers language-none"><code class="language-none">dotnet run<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/images/posts/2022/MinimalAPIsParteI/Ejecutar web app en Visual Studio Code.png" loading="lazy" decoding="async" 
title="Generar certificado HTTPS y ejecutar Web App Visual en Studio Code" 
alt="Generar certificado HTTPS y ejecutar Web App Visual en Studio Code" 
class="article-image"/></p>
<p>Observá que la interfaz de línea de comando .NET (.NET cli) genera<br>un único método que arroja el famoso mensaje “Hello World” con solo cuatro líneas de código. ¿No te parece sencillo y eficiente?</p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> WebApplication<span class="token punctuation">.</span><span class="token function">CreateBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> app <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">MapGet</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"Hello World!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>Podés ejecutar la API en un navegador o en una plataforma de gestión de APIs como Postman importando el siguiente fragmento de código como texto bruto (Raw text):</p>
<pre class="line-numbers language-none"><code class="language-none">curl --location --request GET &#39;http:&#x2F;&#x2F;localhost:5046&#x2F;&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Para cambiar las configuraciones de URLs, entornos, entre otras opciones, editá el archivo launchSettings.json en la carpeta Properties.</p>
<p><img src="/images/posts/2022/MinimalAPIsParteI/Launchsettings.png" loading="lazy" decoding="async" 
title="Archivo launchSetting.json" 
alt="Archivo launchSetting.json para editar configuraciones como applicationUrl y environmentVariables" 
class="article-image"/></p>
<p>Si eliminás el mismo la API se ejecutará en<br><a class="link"   target="_blank" rel="noopener" href="http://localhost:5000/" >http://localhost:5000<i class="fas fa-external-link-alt"></i></a><br><a class="link"   target="_blank" rel="noopener" href="https://localhost:5001/" >https://localhost:5001<i class="fas fa-external-link-alt"></i></a><br>en Hosting environment: Production.</p>
<p>ASP.NET Core 6 utiliza los métodos MapPost(), MapGet(),MapPut(), MapDelete() para definir rutas y manejadores con Minimal APIs ligados a operaciones de inserción ,listado, modificación y borrado, también llamadas CRUD (acrónimo de <strong>C</strong>reate, <strong>R</strong>ead, <strong>U</strong>pdate, <strong>D</strong>elete).</p>
<p>A continuación modificá el código de la clase Program.cs para incluir cuatro nuevos llamados API:</p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">app<span class="token punctuation">.</span><span class="token function">MapGet</span><span class="token punctuation">(</span><span class="token string">"/parameters"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"List all parameters."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">MapPost</span><span class="token punctuation">(</span><span class="token string">"/parameter"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"Add parameter."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">MapPut</span><span class="token punctuation">(</span><span class="token string">"/parameter"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"Edit parameter."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">MapDelete</span><span class="token punctuation">(</span><span class="token string">"/parameter"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">"Delete parameter."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p>Nuevamente podés ejecutar las APIs en un navegador o en Postman importando los siguientes fragmentos de código como texto bruto (Raw text):</p>
<pre class="line-numbers language-none"><code class="language-none">curl --location --request GET &#39;http:&#x2F;&#x2F;localhost:5046&#x2F;parameters&#39;

curl --location --request POST &#39;http:&#x2F;&#x2F;localhost:5046&#x2F;parameter&#39;

curl --location --request PUT &#39;http:&#x2F;&#x2F;localhost:5046&#x2F;parameter&#39;

curl --location --request DELETE &#39;http:&#x2F;&#x2F;localhost:5046&#x2F;parameter&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="ASP-NET-Core-Entity-Framework"><a href="#ASP-NET-Core-Entity-Framework" class="headerlink" title="ASP.NET Core Entity Framework"></a>ASP.NET Core Entity Framework</h3><p>Para desarrollar las operaciones CRUD utilizaremos la base de datos SQLite con Entity Framework Core e instalación vía “Migrations”.<br>Agregá los paquetes necesarios ejecutando por terminal los siguientes comandos:</p>
<pre class="line-numbers language-none"><code class="language-none">dotnet add package Microsoft.Design
dotnet add package Microsoft.Tools
dotnet add package Microsoft.EntityFrameworkCore
dotnet add package Microsoft.InMemory
dotnet add package Microsoft.Sqlite<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>Estos comandos instalan las últimas versiones de los paquetes. Si tenés problemas de compatibilidad o querés utilizar una versión anterior podés especificarlo como en el siguiente ejemplo:</p>
<pre class="line-numbers language-none"><code class="language-none">dotnet add package Microsoft.EntityFrameworkCore -v 6.0.6<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Ahora instalá <strong>dotnet ef</strong> en forma global que es la más común:</p>
<pre class="line-numbers language-none"><code class="language-none">dotnet tool install --global dotnet-ef<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>Ejecutá los dos comandos para crear la base de datos. El primer comando configura los archivos necesarios de migración (utilizo el nombre “Initial”) para que se generen dentro de la carpeta Data/Migrations del proyecto (podés modificar las ruta a tu medida). </p>
<pre class="line-numbers language-none"><code class="language-none">
dotnet ef migrations add &quot;Initial&quot; --project ..&#x2F;MinimalAPIs&#x2F;MinimalAPIs.csproj -o &quot;..&#x2F;MinimalAPIs&#x2F;Data&#x2F;Migrations&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>El segundo comando aplica la configuración generada y crea la base de datos Eco.db dentro de la carpeta Data. </p>
<pre class="line-numbers language-none"><code class="language-none">dotnet ef database update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>Para parametrizar la base de datos utilizá la ruta contenida en la sección connectionString, AppDb del archivo appsettings.json.<br>Migrations utiliza la configuración del DbContext a la que llamaremos AppDbContext.</p>
<p>Para realizar las operaciones de SQLite te recomiendo instalar una extensión de Visual Studio Code como SQLite.</p>
<p><img src="/images/posts/2022/MinimalAPIsParteI/SQLite Extension.png" loading="lazy" decoding="async" 
title="Extensión SQLite" 
alt="Instalación Extensión SQLite para Visual Studio Code" 
class="article-image"/></p>
<p><img src="/images/posts/2022/MinimalAPIsParteI/SQLite New Query.png" loading="lazy" decoding="async" 
title="Extensión SQLite - New Query" 
alt="Ejecución SQLite para Visual Studio Code - New Query" 
class="article-image"/></p>
<p><img src="/images/posts/2022/MinimalAPIsParteI/SQLite Run Query.png" loading="lazy" decoding="async" 
title="Extensión SQLite - Run Query" 
alt="Ejecución SQLite para Visual Studio Code - Run Query" 
class="article-image"/></p>
<p>Hasta aquí lo relacionado con Entity Framework Core.</p>
<p>Ahora podés instalar Swagger *** ejecutando por terminal el comando</p>
<pre class="line-numbers language-none"><code class="language-none">dotnet add package Swashbuckle.AspNetCore <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>A continuación, modificá el archivo Program.cs. No soy proclive a comentar código, en este caso apunto a clarificar como desarrollar las operaciones CRUD.</p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> WebApplication<span class="token punctuation">.</span><span class="token function">CreateBuilder</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Agregado del servicio Swagger.</span>
builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddEndpointsApiExplorer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddSwaggerGen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Configuración de la base de datos vía appsettings.json.</span>
<span class="token class-name"><span class="token keyword">var</span></span> connectionString <span class="token operator">=</span> builder<span class="token punctuation">.</span>Configuration<span class="token punctuation">[</span><span class="token string">"ConnectionStrings:AppDb"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//Agregado del DbContext a los servicios para la utilización de la base de datos SQLite a la que llamé Eco.</span>
builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContext</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AppDbContext<span class="token punctuation">></span></span></span><span class="token punctuation">(</span>options <span class="token operator">=></span> options<span class="token punctuation">.</span><span class="token function">UseSqlite</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> app <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Inicialización de Swagger en un entorno de desarrollo.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>app<span class="token punctuation">.</span>Environment<span class="token punctuation">.</span><span class="token function">IsDevelopment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    app<span class="token punctuation">.</span><span class="token function">UseSwagger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">UseSwaggerUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//API para obtener objetos de tipo Parameter previamente ingresados o un resultado vacío (recibe como parámetro el DbContext).</span>
app<span class="token punctuation">.</span><span class="token function">MapGet</span><span class="token punctuation">(</span><span class="token string">"/parameters"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span> <span class="token class-name">AppDbContext</span> context <span class="token punctuation">)</span> <span class="token operator">=></span>
<span class="token punctuation">&#123;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> parameterslst <span class="token operator">=</span> <span class="token keyword">await</span> context<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">ToListAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parameterslst<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">Created</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"/parameters/</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">parameterslst</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> parameterslst<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token string">"There are no parameters."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//API para insertar un objeto Parameter o visualizar un mensaje de objeto previamente agregado (recibe el DbContext y un objeto de tipo Parameter).</span>
app<span class="token punctuation">.</span><span class="token function">MapPost</span><span class="token punctuation">(</span><span class="token string">"/parameter"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span> <span class="token class-name">AppDbContext</span> context<span class="token punctuation">,</span> Parameter <span class="token punctuation">)</span> <span class="token operator">=></span> 
<span class="token punctuation">&#123;</span>    
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> context<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">FindAsync</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span>Id<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token punctuation">)</span> 
    <span class="token punctuation">&#123;</span>      
        parameter<span class="token punctuation">.</span>Created <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
        <span class="token keyword">await</span> context<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">AddAsync</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> context<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">Created</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"/parameter/</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">parameter</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>   parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>         
    <span class="token punctuation">&#125;</span>       
    <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token string">"Parameter already exists."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//API para modificar un objeto Parameter previamente ingresado o visualizar un mensaje de objeto inexistente (recibe el DbContext y un objeto de tipo Parameter).</span>
app<span class="token punctuation">.</span><span class="token function">MapPut</span><span class="token punctuation">(</span><span class="token string">"/parameter"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span> <span class="token class-name">AppDbContext</span> context<span class="token punctuation">,</span> <span class="token punctuation">,</span> Parameter <span class="token punctuation">)</span> <span class="token operator">=></span> 
<span class="token punctuation">&#123;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> parameterup <span class="token operator">=</span>  <span class="token keyword">await</span> context<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">FindAsync</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parameterup <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>        
        parameterup<span class="token punctuation">.</span>Description <span class="token operator">=</span> parameter<span class="token punctuation">.</span>Description<span class="token punctuation">;</span>
        parameterup<span class="token punctuation">.</span>Updated <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
        <span class="token keyword">await</span> context<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">Ok</span><span class="token punctuation">(</span>parameterup<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token string">"Parameter does not exist."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//API para eliminar un objeto Parameter previamente ingresado o visualizar un mensaje de objeto inexistente (recibe el DbContext y el id del Parameter).</span>
app<span class="token punctuation">.</span><span class="token function">MapDelete</span><span class="token punctuation">(</span><span class="token string">"/parameter/&#123;id&#125;"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span> <span class="token class-name">AppDbContext</span> context<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> id <span class="token punctuation">)</span> <span class="token operator">=></span> 
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> context<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">FindAsync</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token class-name">Parameter</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        context<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> context<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">Ok</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token string">"Parameter does not exist."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Definición de la clase Parameter.</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Parameter</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">&#123;</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Description <span class="token punctuation">&#123;</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>    
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> Created <span class="token punctuation">&#123;</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> Updated <span class="token punctuation">&#123;</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    
<span class="token punctuation">&#125;</span>

<span class="token comment">//Definición del DbContext para la utilización de la tabla Parameter de la base de datos.</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppDbContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token function">AppDbContext</span><span class="token punctuation">(</span><span class="token class-name">DbContextOptions</span> options<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">base</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span> Parameter<span class="token punctuation">></span></span>  Parameters <span class="token punctuation">&#123;</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token operator">!</span><span class="token punctuation">;</span>        
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Podés pasar como segundo parámetro de un método de API (delegate handler) un método desarrollado a medida. Una opción sería modificar el método de API MapPost() de la siguiente forma:</p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp">app<span class="token punctuation">.</span><span class="token function">MapPost</span><span class="token punctuation">(</span><span class="token string">"/parameter"</span><span class="token punctuation">,</span> Add <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>IResult<span class="token punctuation">></span></span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name">AppDbContext</span> context<span class="token punctuation">,</span> Parameter <span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> context<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">FindAsync</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span>Id<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token punctuation">)</span> 
    <span class="token punctuation">&#123;</span>      
        parameter<span class="token punctuation">.</span>Created <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
        <span class="token keyword">await</span> context<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">AddAsync</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> context<span class="token punctuation">.</span><span class="token function">SaveChangesAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
        <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">Created</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"/parameter/</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token expression language-csharp">parameter</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>         
    <span class="token punctuation">&#125;</span>       
    <span class="token keyword">return</span> Results<span class="token punctuation">.</span><span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token string">"Parameter already exists."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token punctuation">&#125;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Test-Unitarios"><a href="#Test-Unitarios" class="headerlink" title="Test Unitarios"></a>Test Unitarios</h3><p>No nos olvidemos de los test. Muchas veces los hemos desestimado por comodidad, dificultad o desconocimiento. Como toda práctica en programación, necesitamos aprender los fundamentos, ejercitar y mejorar con cada uno de nuestros proyectos. Sin dudas los test son una herramienta que apunta a aplicar buenas prácticas de desarrollo, y por ende, a mejorar la calidad del software.<br>Este artículo no pretende profundizar en detalle sobre test unitarios pero puede servir como introducción y guía.<br>Utilizaremos el paquete <strong>XUnit</strong>.</p>
<p>Separá los métodos de test creando un nuevo proyecto. Para esto ejecutá el comando</p>
<pre class="line-numbers language-none"><code class="language-none">dotnet new xunit -n MinimalAPIs.Test <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>que genera la plantilla .NET con los archivos y paquetes esenciales para comenzar a desarrollar métodos de test.</p>
<p>Es imprescindible modificar el archivo del proyecto base (al que llamé MinimalAPIs.csproj) para incorporar el atributo <strong>InternalsVisibleTo</strong> </p>
<pre class="line-numbers language-none"><code class="language-none">&lt;ItemGroup&gt;
     &lt;InternalsVisibleTo Include&#x3D;&quot;MinimalAPIs.Test&quot; &#x2F;&gt;
&lt;&#x2F;ItemGroup&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>


<p>De esta forma el proyecto de test puede tener visibilidad del archivo Program.cs.</p>
<p>Generá la referencia al proyecto base en el proyecto de test con el comando</p>
<pre class="line-numbers language-none"><code class="language-none">dotnet add reference  ..&#x2F;MinimalAPIs&#x2F;MinimalAPIs.csproj<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<p>Una buena forma de estructurar los test es utilizar el patrón <strong>AAA</strong> (acrónimo de <strong>A</strong>rrange-<strong>A</strong>ct-<strong>A</strong>ssert).<br>AAA describe tres fases o pasos involucrados en el test dentro de un método:<br><strong>Arrange</strong>: en esta fase se configuran e inicializan los objetos que sirven de entrada para el test.<br><strong>Act</strong>: esta fase contiene el comportamiento principal del test. Puede estar relacionado a la llamada a un método como una API Rest.<br><strong>Arrange</strong>: esta etapa se utiliza para verificar el resultado del test, es decir, si se cumple o falla.</p>
<p>Para escribir los test podés utilizar los archivos de clases que consideres necesarios. Como se trata de una aplicación simple, te propongo utilizar una única clase a la que llamo UnitTest.cs.</p>
<p>A continuación podés ver la clase TestAplication que es una fábrica que crea el Host con una base de datos en memoria en reemplazo de SQLite. Es importante destacar el punto de entrada de la fábrica que es la clase Program.cs del proyecto base.</p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">class</span> <span class="token class-name">TestApplication</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">WebApplicationFactory<span class="token punctuation">&lt;</span>Program<span class="token punctuation">></span></span></span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">IHost</span> <span class="token function">CreateHost</span><span class="token punctuation">(</span><span class="token class-name">IHostBuilder</span> builder<span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>   
     	builder<span class="token punctuation">.</span><span class="token function">ConfigureServices</span><span class="token punctuation">(</span>services <span class="token operator">=></span>
        <span class="token punctuation">&#123;</span>	        
            <span class="token comment">//Los servicio de tipo Scoped se crean una vez por solicitud. </span>
            services<span class="token punctuation">.</span><span class="token function">AddScoped</span><span class="token punctuation">(</span>sp <span class="token operator">=></span>
            <span class="token punctuation">&#123;</span>   
                <span class="token comment">//La base de datos en memoria Eco contine la estructura del DbContext.       </span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DbContextOptionsBuilder<span class="token punctuation">&lt;</span>AppDbContext<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">UseInMemoryDatabase</span><span class="token punctuation">(</span><span class="token string">"Eco"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">UseApplicationServiceProvider</span><span class="token punctuation">(</span>sp<span class="token punctuation">)</span>
                <span class="token punctuation">.</span>Options<span class="token punctuation">;</span>                 
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">CreateHost</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>El siguiente es un test simple con aplicación de las tres fases AAA. El atributo <strong>[Fact]</strong> declara un método de prueba que el ejecutor o gestor de pruebas puede correr.</p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">GetHelloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>                 
     <span class="token comment">// Arrange	    </span>
    <span class="token comment">//Instancia de la aplicación para crear un cliente Http.</span>
    <span class="token keyword">await</span> <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> application <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TestApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token class-name">HttpClient</span> client <span class="token operator">=</span> application<span class="token punctuation">.</span><span class="token function">CreateClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Act</span>
    <span class="token comment">//Ejecución asincrٴónica del método API Get en la ruta base.</span>
    <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    response<span class="token punctuation">.</span><span class="token function">EnsureSuccessStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Resultado en formato String del método ejecutado.</span>
    <span class="token class-name"><span class="token keyword">var</span></span> responseBody <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span>Content<span class="token punctuation">.</span><span class="token function">ReadAsStringAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token comment">// Assert       	    </span>
    <span class="token comment">//Validación de coincidencia entre el resultado del método y la frase “Hello World!” </span>
    Assert<span class="token punctuation">.</span><span class="token function">Matches</span><span class="token punctuation">(</span><span class="token string">"Hello World!"</span><span class="token punctuation">,</span> responseBody<span class="token punctuation">)</span><span class="token punctuation">;</span>        
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>A continuación te muestro test de la creación de un objeto Parameter a partir de la ejecución de un método de API Post.</p>
<pre class="line-numbers language-csharp" data-language="csharp"><code class="language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">PostParameterAsJsonStatusCreated</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>        
     <span class="token comment">// Arrange</span>
    <span class="token comment">//Instancia de la aplicación para crear un cliente Http. 	    </span>
    <span class="token keyword">await</span> <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> application <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TestApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token class-name">HttpClient</span> client <span class="token operator">=</span> application<span class="token punctuation">.</span><span class="token function">CreateClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//Objeto Parameter a crear a través del método POST.</span>
    <span class="token class-name"><span class="token keyword">int</span></span> id <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">string</span></span> description <span class="token operator">=</span> <span class="token string">"Parameter 123"</span><span class="token punctuation">;</span>
    Parameter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Parameter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> Id <span class="token operator">=</span> id<span class="token punctuation">,</span> Description <span class="token operator">=</span> description <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>     
    
    <span class="token comment">// Act              </span>
    <span class="token comment">//Ejecución asincrٴónica del método de API POST con el parámetro de entrada parameter. </span>
    <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">PostAsJsonAsync</span><span class="token punctuation">(</span><span class="token string">"/parameter"</span><span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Resultado en formato Json del método ejecutado.</span>
    <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span>Content<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ReadFromJsonAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Parameter<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    <span class="token comment">// Assert </span>
    Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>HttpStatusCode<span class="token punctuation">.</span>Created<span class="token punctuation">,</span> response<span class="token punctuation">.</span>StatusCode<span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token comment">//Validación de coincidencia entre la variable id y el campo Id del objeto Parameter   </span>
    creado <span class="token return-type class-name">y</span> devuelto<span class="token punctuation">.</span>      
    Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> result<span class="token punctuation">?.</span>Id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Validación de coincidencia entre la variable description y el campo Description del </span>
    objeto Parameter creado <span class="token return-type class-name">y</span> devuelto<span class="token punctuation">.</span>      
    Assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>description<span class="token punctuation">,</span> result<span class="token punctuation">?.</span>Description<span class="token punctuation">)</span><span class="token punctuation">;</span>        
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>Te dejo el resto de los test disponibles para descarga.</p>
<p>Para ejecutarlos todos a la vez podés usar el comando </p>
<pre class="line-numbers language-none"><code class="language-none">dotnet test <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>o individualmente</p>
<pre class="line-numbers language-none"><code class="language-none">
dotnet test --filter &quot;FullyQualifiedName&#x3D;MinimalAPIs.Test.UnitTest.PostParameterAsJsonStatusCreated&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>Resulta más eficiente instalar una extensión como <strong>.NET Core Test Explorer</strong> que nos permite realizar pruebas individuales y completas utilizando una interfaz gráfica muy sencilla y amigable.</p>
<p><img src="/images/posts/2022/MinimalAPIsParteI/NET Core Test Explorer.png" loading="lazy" decoding="async" 
title="Extensión .NET Core Test Explorer" 
alt="Extensión .NET Core Test Explorer para Visual Studio Code" 
class="article-image"/></p>
<p>Luego de ejecutar los test con resultados válidos, la aplicación estaría en condiciones de probarse en Postman importando los siguientes fragmentos de código como texto bruto (Raw text):</p>
<pre class="line-numbers language-none"><code class="language-none">curl --location --request GET &#39;http:&#x2F;&#x2F;localhost:5046&#x2F;parameters&#39;

curl --location --request POST &#39;http:&#x2F;&#x2F;localhost:5046&#x2F;parameter&#39; \
--header &#39;Content-Type: application&#x2F;json&#39; \
--data-raw &#39;&#123;
&quot;Id&quot; : 1,
&quot;Description&quot; : &quot;Parameter 1&quot;
&#125;&#39;

curl --location --request PUT &#39;http:&#x2F;&#x2F;localhost:5046&#x2F;parameter&#39; \
--header &#39;Content-Type: application&#x2F;json&#39; \
--data-raw &#39;&#123;
&quot;Id&quot; : 1,
&quot;Description&quot; : &quot;Parameter 1.1&quot;
&#125;&#39;

curl --location --request DELETE &#39;http:&#x2F;&#x2F;localhost:5046&#x2F;parameter&#x2F;1&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/images/posts/2022/MinimalAPIsParteI/Postman POST.png" loading="lazy" decoding="async" 
title="Postman - POST" 
alt="Post en Postman con Minimal APIs" 
class="article-image"/></p>
<p>También podés probar las APIs accediendo a Swagger a través de:</p>
<p><a class="link"   target="_blank" rel="noopener" href="http://localhost:5046/swagger/index.html" >http://localhost:5046/swagger/index.html<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="/images/posts/2022/MinimalAPIsParteI/Swagger POST.png" loading="lazy" decoding="async" 
title="Swagger - POST" 
alt="Post en Swagger con Minimal APIs" 
class="article-image"/></p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusión"></a>Conclusión</h3><p>Hemos desarrollado un paquete de operaciones CRUD con minimal APIs reduciendo el código y eliminando la necesidad del archivo Startup.cs necesario en versiones anteriores de .NET Core.<br>En el link de descarga <a class="link"   target="_blank" rel="noopener" href="https://github.com/juanmanuelcutrera/NET" >https://github.com/juanmanuelcutrera/NET<i class="fas fa-external-link-alt"></i></a> podés acceder al código del artículo. Organicé la aplicación en subcarpetas para separar funcionalidades y evitar un mínimo de código espagueti en el archivo Program.cs. No obstante, podés refactorizar el código e incluir más tests hasta el punto que te parezca conveniente.</p>
<p>(*)<br><a class="link"   target="_blank" rel="noopener" href="https://code.visualstudio.com/download" >https://code.visualstudio.com/download<i class="fas fa-external-link-alt"></i></a></p>
<p>(**)<br><a class="link"   target="_blank" rel="noopener" href="https://docs.microsoft.com/es-es/powershell/" >https://docs.microsoft.com/es-es/powershell/<i class="fas fa-external-link-alt"></i></a></p>
<p>(***)<br><a class="link"   target="_blank" rel="noopener" href="https://docs.microsoft.com/es-es/aspnet/core/tutorials/web-api-help-pages-using-swagger?view=aspnetcore-6.0" >https://docs.microsoft.com/es-es/aspnet/core/tutorials/web-api-help-pages-using-swagger?view=aspnetcore-6.0<i class="fas fa-external-link-alt"></i></a></p>

        </div>

        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/NET-6/">#.NET 6</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/Minimal-APIs/">#Minimal APIs</a>&nbsp;
                    </li>
                
                    <li class="tag-item">
                        <a href="/tags/ASP-NET-Core-Entity-Framework/">#ASP.NET Core Entity Framework</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/07/17/hello-world/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Hello World</span>
                                <span class="post-nav-item">Posts Siguientes</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2022</span>
             
            
          
            <span>Juan Manuel Cutrera. Todos los derechos reservados.</span>
            
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                
            </div>
        

        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep </a>
        </div>
        
     
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">

            <i class="fas fa-wrench"></i>

        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Introduccion"><span class="nav-number">1.</span> <span class="nav-text">Introducción</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ASP-NET-Core-Entity-Framework"><span class="nav-number">2.</span> <span class="nav-text">ASP.NET Core Entity Framework</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Test-Unitarios"><span class="nav-number">3.</span> <span class="nav-text">Test Unitarios</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Conclusion"><span class="nav-number">4.</span> <span class="nav-text">Conclusión</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Búsqueda..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>





<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>










<div class="post-scripts pjax">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>






<script src="/js/prismjs/prism.js"></script>



<script src="/js/prismjs/plugins/toolbar/prism-toolbar.min.js"></script>


<script src="/js/prismjs/plugins/line-numbers/prism-line-numbers.min.js"></script>


<script src="/js/prismjs/plugins/autoloader/prism-autoloader.min.js"></script>


<script src="/js/prismjs/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>



</body>
</html>
